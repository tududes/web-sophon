<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSophon New Features Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
            text-align: center;
        }

        h2 {
            color: #666;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .feature-item {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 4px;
        }

        .feature-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }

        .test-steps {
            margin-left: 20px;
        }

        .test-steps li {
            margin: 5px 0;
        }

        .expected {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 8px;
            border-radius: 3px;
            margin-top: 8px;
            font-size: 13px;
        }

        .webhook-example {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
            word-break: break-all;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>

<body>
    <h1>üß™ WebSophon v2.6 New Features Test</h1>

    <div class="test-section">
        <h2>üõë Request Cancellation Testing</h2>

        <div class="feature-item">
            <div class="feature-title">Test 1: Cancel Pending Request</div>
            <ol class="test-steps">
                <li>Use a slow webhook: <code class="webhook-example">https://httpbin.org/delay/60</code></li>
                <li>Add a test field and configure webhook URL</li>
                <li>Click "Capture Screenshot Now"</li>
                <li>Quickly open Event History - you should see pending event</li>
                <li>Click the red "Cancel Request" button</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> Event updates to show "Request cancelled by user" status
            </div>
        </div>

        <div class="feature-item">
            <div class="feature-title">Test 2: Multiple Concurrent Cancellations</div>
            <ol class="test-steps">
                <li>Enable automatic capture with 10-second interval</li>
                <li>Use slow webhook: <code class="webhook-example">https://httpbin.org/delay/30</code></li>
                <li>Wait for 2-3 pending events to appear</li>
                <li>Cancel them individually</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> Each request cancels independently without affecting others
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üì± Smart Response Display Testing</h2>

        <div class="feature-item">
            <div class="feature-title">Test 3: JSON Response Formatting</div>
            <ol class="test-steps">
                <li>Use webhook that returns JSON: <code class="webhook-example">https://httpbin.org/json</code></li>
                <li>Capture a screenshot</li>
                <li>Expand the event details and check Response Data</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> JSON response is nicely formatted with proper indentation
            </div>
        </div>

        <div class="feature-item">
            <div class="feature-title">Test 4: Raw Text Response Display</div>
            <ol class="test-steps">
                <li>Use webhook that returns HTML: <code class="webhook-example">https://httpbin.org/html</code></li>
                <li>Capture a screenshot</li>
                <li>Expand the event details and check Response Data</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> Raw HTML shown with warning "‚ö†Ô∏è Raw response (not valid JSON)"
            </div>
        </div>

        <div class="feature-item">
            <div class="feature-title">Test 5: Error Response Display</div>
            <ol class="test-steps">
                <li>Use invalid webhook URL: <code class="webhook-example">https://httpbin.org/status/500</code></li>
                <li>Capture a screenshot</li>
                <li>Check that response data shows the error details</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> HTTP 500 error shown with raw response content
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üíæ Screenshot Download Testing</h2>

        <div class="feature-item">
            <div class="feature-title">Test 6: Download Screenshots</div>
            <ol class="test-steps">
                <li>Capture several screenshots</li>
                <li>Expand event details to see screenshots</li>
                <li>Click the "üíæ Download" button above each screenshot</li>
                <li>Check your Downloads folder</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> Files downloaded with names like
                "websophon-screenshot-2025-01-11-15-30-45.png"
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üîç Advanced Image Zoom Testing</h2>

        <div class="feature-item">
            <div class="feature-title">Test 7: Mouse-Following Zoom</div>
            <ol class="test-steps">
                <li>Capture a screenshot with detailed content</li>
                <li>Expand the event to see the screenshot</li>
                <li>Hover over different areas of the image</li>
                <li>Move mouse around while hovering</li>
                <li>Notice the zoom follows your mouse position</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> 2x zoom centered on mouse position, allowing exploration of all areas
            </div>
        </div>

        <div class="feature-item">
            <div class="feature-title">Test 8: Zoom Interaction</div>
            <ol class="test-steps">
                <li>While hovering over a screenshot, try clicking</li>
                <li>Try expanding/collapsing the event while zoomed</li>
                <li>Move mouse away to exit zoom</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> Zoom doesn't interfere with other interactions, smooth reset on mouse leave
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>üêõ Debug Mode Testing</h2>

        <div class="warning">
            <strong>Note:</strong> Enable debug mode first by running in console:
            <code>localStorage.setItem('websophon-debug', 'true')</code>
        </div>

        <div class="feature-item">
            <div class="feature-title">Test 9: Test Events with New Features</div>
            <ol class="test-steps">
                <li>Enable debug mode and reload extension</li>
                <li>Click the "üß™ Test Events" button</li>
                <li>Test all new features on the generated events</li>
                <li>Try downloading test screenshots</li>
                <li>Test zoom on test images</li>
                <li>Check response formatting</li>
            </ol>
            <div class="expected">
                ‚úÖ <strong>Expected:</strong> All features work on test events including pending, success, and error
                states
            </div>
        </div>
    </div>

    <div class="test-section">
        <h2>‚úÖ Success Criteria</h2>
        <p>All features are working correctly if you can:</p>
        <ul>
            <li>Cancel pending webhook requests and see them marked as cancelled</li>
            <li>View formatted JSON responses and raw text for non-JSON</li>
            <li>Download screenshots with timestamped filenames</li>
            <li>Zoom into screenshots with mouse-following 2x magnification</li>
            <li>Use all features without breaking existing functionality</li>
        </ul>
    </div>

    <script>
        console.log('WebSophon v2.6 new features test page loaded');
        console.log('Test the new request cancellation, response display, downloads, and zoom features!');

        // Add some dynamic content for screenshot testing
        setInterval(() => {
            document.querySelector('h1').style.color = `hsl(${Date.now() % 360}, 70%, 50%)`;
        }, 2000);
    </script>
</body>

</html>