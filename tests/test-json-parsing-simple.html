<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Parsing Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .result {
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }

        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }

        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
            white-space: pre-wrap;
        }

        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>JSON Parsing Fix Test</h1>
        <p>Testing the new simple string replacement approach for LLM responses with markdown.</p>

        <button onclick="runTest()">Run Test</button>
        <button onclick="compareOld()">Compare with Old Method</button>

        <div id="results"></div>
    </div>

    <script>
        // New parsing method (fixed)
        function parseWithNewMethod(content) {
            let jsonContent = content
                .replaceAll("```json", "")
                .replaceAll("```", "")
                .trim();

            try {
                return {
                    success: true,
                    data: JSON.parse(jsonContent),
                    method: "String Replacement"
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message,
                    method: "String Replacement"
                };
            }
        }

        // Old parsing method (for comparison)
        function parseWithOldMethod(content) {
            let jsonContent = content;

            const codeBlockRegex = /```(?:json)?\s*([\s\S]*?)\s*```/;
            const codeBlockMatch = content.match(codeBlockRegex);
            if (codeBlockMatch) {
                jsonContent = codeBlockMatch[1].trim();
            }

            try {
                return {
                    success: true,
                    data: JSON.parse(jsonContent),
                    method: "Regex"
                };
            } catch (error) {
                return {
                    success: false,
                    error: error.message,
                    method: "Regex"
                };
            }
        }

        function displayResult(result, testContent) {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'result ' + (result.success ? 'success' : 'error');

            resultDiv.innerHTML =
                '<h3>' + result.method + ' Method</h3>' +
                '<p><strong>Status:</strong> ' + (result.success ? 'SUCCESS' : 'FAILED') + '</p>' +
                (result.success ?
                    '<p><strong>Parsed Data:</strong></p><pre>' + JSON.stringify(result.data, null, 2) + '</pre>' :
                    '<p><strong>Error:</strong> ' + result.error + '</p>'
                ) +
                '<details><summary>Test Input</summary><pre>' + testContent + '</pre></details>';

            document.getElementById('results').appendChild(resultDiv);
        }

        function runTest() {
            document.getElementById('results').innerHTML = '<h2>New Parsing Method Test</h2>';

            // Create test content with markdown-wrapped JSON
            const testContent = '```json\n' +
                '{\n' +
                '  "is_crazy": [false, 0.95],\n' +
                '  "bullish_on_btc": [false, 0.98],\n' +
                '  "reason": "The screenshot shows normal content"\n' +
                '}\n' +
                '```';

            const result = parseWithNewMethod(testContent);
            displayResult(result, testContent);
        }

        function compareOld() {
            document.getElementById('results').innerHTML = '<h2>Method Comparison</h2>';

            // Create test content
            const testContent = '```json\n' +
                '{\n' +
                '  "test_field": [true, 0.85],\n' +
                '  "another_field": [false, 0.92]\n' +
                '}\n' +
                '```';

            const newResult = parseWithNewMethod(testContent);
            const oldResult = parseWithOldMethod(testContent);

            displayResult(newResult, testContent);
            displayResult(oldResult, testContent);
        }

        // Auto-run test on page load
        window.onload = function () {
            runTest();
        };
    </script>
</body>

</html>